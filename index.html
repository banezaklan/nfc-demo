<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <meta http-equiv="origin-trial" content="AjYc0hTggXCNDoIJrcJ7qm5JAYufFgsdZrRw5x4LfxlIuU3C7t5fhhwmKgp5ydOCjQdnUiuE//pL85k75Exdjg4AAABdeyJvcmlnaW4iOiJodHRwczovL2dpdGh1Yi5jb206NDQzIiwiZmVhdHVyZSI6IldlYk5GQyIsImV4cGlyeSI6MTU4NjUyODc1MiwiaXNTdWJkb21haW4iOnRydWV9">
</head>
<body>
<div><p>Version 9</p></div>
<div id="mess" style="font-size: 24px;"></div>
</body>
<script type="application/javascript">

  const addMess = (mess)=>{
    document.getElementById("mess").innerHTML += `<p>${mess}</p>`;
  }

  const nfcRead = async ()=>{
    if ('NDEFReader' in window) {
      addMess('NDEFReader present');
      const reader = new NDEFReader();

      await navigator.permissions.query({name:'nfc'}).then(function(permissionStatus) {
        addMess('Permission status is ', permissionStatus.state);
        permissionStatus.onchange = function() {
          console.log('Permission status has changed to ', this.state);
        };
      });

      await reader.scan().then(() => {
        addMess('NDEFReader activated!')
      }).catch( e => {
        addMess(e);
      })
      reader.onreading = ({ message })=>{
        addMess(`### ${message}`)
      }

    } else {
      console.warn('There is no NDEReader in window!');
      document.getElementById("mess").innerHTML += "<p>There is no NDEReader in window!</p>";
    }
  }
  nfcRead()
</script>
</html>
